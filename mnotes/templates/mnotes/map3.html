{% extends 'mnotes/base.html' %}
{% block content %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script>

async function initMap() {
  var location = {{ location|safe }};
  // Request needed libraries.
  const { Map, InfoWindow } = await google.maps.importLibrary("maps");
  const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
  const map = new Map(document.getElementById("map"), {
    center: { lat: location.lat, lng: location.lng },
    zoom: 14,
    mapId: "3",
  });
  const infoWindow = new InfoWindow();
  const draggableMarker = new AdvancedMarkerElement({
    map,
    gmpDraggable: true,
    title: "This marker is draggable.",
  });

  draggableMarker.addListener("dragend", (event) => {
    const position = draggableMarker.position;

    infoWindow.setContent(`Pin dropped at: ${position.lat}, ${position.lng}`);

  });

  var addMarker = once(placeMarkerAndPanTo);
  map.addListener("click", (e) => {
    addMarker(e.latLng, map)
  });
}

function once(fn, context) {
    var result;
    return function() {
        if (fn) {
            result = fn.apply(context || this, arguments);
            fn = null;
        }
        return result;
    };
}

function placeMarkerAndPanTo(latLng, map) {
  new google.maps.marker.AdvancedMarkerElement({
    position: latLng,
    map: map,
    gmpDraggable: true,
  });
  map.panTo(latLng);
}


initMap();

</script>

<div class="pageholder">
    <div class="titleholder"> 

        <div class="title"> Google Maps API Displaying Markers on the Map </div> 
        
    </div>


    <div class="linkholder">
        <div class="mapholder"> 
            <div id="map"> </div>

            <script async
                src="https://maps.googleapis.com/maps/api/js?key={{key}}&callback=initMap">
            </script>

        </div>
        
     </div>


    <div class="linkholder">  
        <a href="{% url 'notes' %}"> Go to our homepage</a>

    </div>



</div>


{% endblock %}